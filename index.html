<!DOCTYPE html>
<html>

<head>
    <title>Gmail</title>
</head>

<body>
    <script type="text/javascript">

        const params = {
            apiKey: "AIzaSyB4-dSaxKjgSAAs1BnKNbi_81mDRW7ni64",
            clientId: "285654233185-2q7fsfhb8obakjdtb9cdal06ug8s21d8.apps.googleusercontent.com",
            discoveryDocs: ["https://www.googleapis.com/discovery/v1/apis/gmail/v1/rest"],
            scope: "https://www.googleapis.com/auth/gmail.readonly",
            ux_mode: 'redirect',
            redirect_uri: 'https://pooja-500apps.github.io/gmail_test/'
        };

        function handleClientLoad() {
            gapi.load("client:auth2", initClient);
        }

        async function initClient() {
            await gapi.client.init(params);
            let isSignedIn = gapi.auth2.getAuthInstance().isSignedIn.get();
            if (isSignedIn) await updateSigninStatus(isSignedIn);
            else {
                gapi.auth2.getAuthInstance().signIn();
                await gapi.auth2.getAuthInstance().isSignedIn.listen((signedIn) => {
                    updateSigninStatus(signedIn);
                });
            }
        }
        async function updateSigninStatus(isSignedIn) {
            if (isSignedIn) {
                let response = {};
                response.data = await gapi.auth.getToken();
                response.client = JSON.stringify(gapi.client);
                window.opener.postMessage(response, '*');
                signOut();
                window.close();
            }
        }
        function signOut() {
            gapi.auth2.getAuthInstance().signOut();
        }
    </script>
    <script async defer src="https://apis.google.com/js/api.js" onload="this.onload=function(){};handleClientLoad()"
        onreadystatechange="if (this.readyState === 'complete') this.onload()"></script>
</body>

</html>
